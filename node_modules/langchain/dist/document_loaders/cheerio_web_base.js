"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CheerioWebBaseLoader = void 0;
const document_1 = require("../document");
const base_1 = require("./base");
let load = null;
try {
    // eslint-disable-next-line global-require,import/no-extraneous-dependencies
    ({ load } = require("cheerio"));
}
catch (_a) {
    // ignore error, will be throw in constructor
}
class CheerioWebBaseLoader extends base_1.BaseDocumentLoader {
    constructor(webPath) {
        super();
        Object.defineProperty(this, "webPath", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: webPath
        });
        /**
         * Throw error at construction time
         * if cheerio package is not installed.
         */
        if (load === null) {
            throw new Error("Please install cheerio as a dependency with, e.g. `yarn add cheerio`");
        }
    }
    static async _scrape(url) {
        if (load === null) {
            throw new Error("Please install cheerio as a dependency with, e.g. `yarn add cheerio`");
        }
        const response = await fetch(url);
        const html = await response.text();
        return load(html);
    }
    async scrape() {
        return CheerioWebBaseLoader._scrape(this.webPath);
    }
    async load() {
        const $ = await this.scrape();
        const text = $("body").text();
        const metadata = { source: this.webPath };
        return [new document_1.Document({ pageContent: text, metadata })];
    }
}
exports.CheerioWebBaseLoader = CheerioWebBaseLoader;
//# sourceMappingURL=cheerio_web_base.js.map